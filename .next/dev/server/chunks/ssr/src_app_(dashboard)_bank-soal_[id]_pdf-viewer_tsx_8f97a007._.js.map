{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Banteng%20Harisantoso/Mentari/mentari-app/src/app/%28dashboard%29/bank-soal/%5Bid%5D/pdf-viewer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\r\nimport { ChevronLeft, ChevronRight, ZoomIn, ZoomOut, Loader2 } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Document, Page, pdfjs } from \"react-pdf\";\r\nimport \"react-pdf/dist/Page/AnnotationLayer.css\";\r\nimport \"react-pdf/dist/Page/TextLayer.css\";\r\n\r\n// Configure pdf.js worker from CDN matching react-pdf's bundled version\r\npdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\r\n\r\ninterface PDFViewerProps {\r\n  fileUrl: string;\r\n}\r\n\r\nexport default function PDFViewer({ fileUrl }: PDFViewerProps) {\r\n  const [numPages, setNumPages] = useState<number | null>(null);\r\n  const [pageNumber, setPageNumber] = useState(1);\r\n  const [scale, setScale] = useState(1.0);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  // Use Uint8Array instead of ArrayBuffer to avoid detachment issues\r\n  const [pdfData, setPdfData] = useState<Uint8Array | null>(null);\r\n\r\n  // Fetch PDF data on mount or when fileUrl changes\r\n  useEffect(() => {\r\n    setPageNumber(1);\r\n    setScale(1.0);\r\n    setError(null);\r\n    setPdfData(null);\r\n    setIsLoading(true);\r\n\r\n    const controller = new AbortController();\r\n\r\n    async function fetchPdf() {\r\n      try {\r\n        const response = await fetch(fileUrl, {\r\n          signal: controller.signal,\r\n          credentials: \"include\",\r\n        });\r\n        if (!response.ok) {\r\n          throw new Error(`Failed to fetch PDF: ${response.status} ${response.statusText}`);\r\n        }\r\n        const buffer = await response.arrayBuffer();\r\n        // Create a Uint8Array copy to prevent detached ArrayBuffer issues\r\n        setPdfData(new Uint8Array(buffer));\r\n      } catch (err: any) {\r\n        if (err.name !== \"AbortError\") {\r\n          console.error(\"PDF fetch error:\", err);\r\n          setError(err.message || \"Failed to load PDF\");\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    fetchPdf();\r\n\r\n    return () => {\r\n      controller.abort();\r\n    };\r\n  }, [fileUrl]);\r\n\r\n  // Memoize the file object to prevent unnecessary reloads\r\n  const fileObject = useMemo(() => {\r\n    if (!pdfData) return null;\r\n    return { data: pdfData };\r\n  }, [pdfData]);\r\n\r\n  const onDocumentLoadSuccess = useCallback(({ numPages }: { numPages: number }) => {\r\n    setNumPages(numPages);\r\n    setIsLoading(false);\r\n    setError(null);\r\n  }, []);\r\n\r\n  const onDocumentLoadError = useCallback((err: Error) => {\r\n    console.error(\"PDF document load error:\", err);\r\n    setError(err.message || \"Failed to parse PDF\");\r\n    setIsLoading(false);\r\n  }, []);\r\n\r\n  const goToPrevPage = () => setPageNumber((p) => Math.max(1, p - 1));\r\n  const goToNextPage = () => setPageNumber((p) => (numPages ? Math.min(numPages, p + 1) : p + 1));\r\n  const zoomOut = () => setScale((s) => Math.max(0.5, s - 0.25));\r\n  const zoomIn = () => setScale((s) => Math.min(3, s + 0.25));\r\n\r\n  return (\r\n    <div>\r\n      {/* Toolbar */}\r\n      <div className=\"flex items-center justify-between p-3 border-b bg-gray-50\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button variant=\"outline\" size=\"sm\" onClick={goToPrevPage} disabled={pageNumber <= 1}>\r\n            <ChevronLeft className=\"h-4 w-4\" />\r\n          </Button>\r\n          <div className=\"text-sm text-muted-foreground\">\r\n            Halaman {pageNumber}{numPages ? ` / ${numPages}` : \"\"}\r\n          </div>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={goToNextPage} disabled={numPages !== null && pageNumber >= numPages}>\r\n            <ChevronRight className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button variant=\"outline\" size=\"sm\" onClick={zoomOut}>\r\n            <ZoomOut className=\"h-4 w-4\" />\r\n          </Button>\r\n          <span className=\"text-sm text-muted-foreground w-12 text-center\">{Math.round(scale * 100)}%</span>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={zoomIn}>\r\n            <ZoomIn className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* PDF Content */}\r\n      <div className=\"relative min-h-[600px]\">\r\n        {isLoading && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center bg-gray-100 z-10\">\r\n            <div className=\"text-center\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-amber-500 mx-auto mb-2\" />\r\n              <p className=\"text-sm text-gray-500\">Memuat dokumen...</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center bg-gray-50 z-10\">\r\n            <div className=\"text-center p-6\">\r\n              <p className=\"text-red-600 mb-2\">Gagal memuat dokumen</p>\r\n              <p className=\"text-sm text-gray-500\">{error}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"w-full flex justify-center p-6 bg-white overflow-auto\">\r\n          {fileObject && (\r\n            <Document\r\n              file={fileObject}\r\n              onLoadSuccess={onDocumentLoadSuccess}\r\n              onLoadError={onDocumentLoadError}\r\n              loading={null}\r\n            >\r\n              <Page\r\n                pageNumber={pageNumber}\r\n                scale={scale}\r\n                width={800}\r\n                renderTextLayer={true}\r\n                renderAnnotationLayer={true}\r\n              />\r\n            </Document>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}